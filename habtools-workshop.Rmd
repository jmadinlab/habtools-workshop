---
output: github_document
---

# `habtools`

### Aims

- To develop an understanding of habitat complexity, including familiarity with geometric measures like rugosity and fractal dimension.
- To become familiar with how to capture benthic 3D meshes, digital evevation models (DEMs) and orthomosaics as a canvas for potential projects that layer on ecological and environmental details.

### Introduction

One of community ecology's few paradigms is that complex habitats tend to contain more species and at higher abundances than simple habitats. Currently, human and natural disturbances are changing the complexity of habitats faster than at any previous time in history. Understanding and predicting the effects of these changes on biodiversity and ecosystem function is now of paramount importance. Yet, we have only a crude, correlative understanding of how complexity changes affect biodiversity, predicting that if habitat becomes flatter, species' diversity and abundances decline. We have next to no idea of how complexity changes affect ecosystem functions and services. Generating accurate predictions requires integration of the geometric and ecological principles that mechanistically underpin complexity-ecological relationships. 

Habitat geometry can be measured in many ways. However, in marine systems, surface rugosity has become gold standard, because it can be measured quickly with a tape measure and a length of chain. The chain is draped as closely as possible over the the benthos and then the linear distance between the two ends of the chain is measured (Fig. 1). Rugosity is calculated as $R = \frac{D_{chain}}{L_{chain}}$. If the surface is completely flat, then $D_{chain}$ will be the same as $L_{chain}$. On more convoluted surfaces, the linear distance $D_{chain}$ is shorter, and rugosity is greater. 

![Figure 1: Rugosity](figs/rugosity.png)

Many studies have found relationships between surface rugosity and the richness and abundance of associated species. Many studies have found no relationship at all, calling into questions what rugosity actually tells us about a habitat and how niches are distributed and partitioned. Advances in the way marine scientists can capture benthic surfaces have transformed our capacity to explore the geometric-biodiversity relationships (Torres-Pulliza et al. 2020). One such advance is the generation of surface structure from motion, which allows us to associate orthomosics of benthic cover (essentially stitched together photographs over large areas) with the 3D surfaces upon which the biodiversity lives (Pizarro et al. 2017). 

### Objectives

1. Generate a digital elevation model (DEM) and an orthomosaic.
2. Calculate three geometric measures (rugosity, fractal dimension and height range) and explore the relationships among them.
3. Think about reef features that could be annotated or measured over your orthomosaic, especially those you believe to be related to habitat complexity. Examples include,  larval settlement, species richness, territorial grazer density, fish size structure, spatial clustering of primary producers, etc. 

### Gear list

- Camera, charged
- Reef recorder (check clip)
- Three scale markers (6 targets)
- GPS to mark center of reef record
- Depth gauge for depths at markers
- Transect tape for measuring between scale markers
- Compass for determining rotation of reef record
- Slate for notes (e.g., GPS, depths)

### Fieldwork

- Find site about a meter deep
- Place reef recorder in the center
- Place scale markers flat within anticipated map area, approximate triangle around reef recorder
- Attach camera
- Start camera and swim normally around stake, keeping line taut, in a spiral fashion
- When line in completely unwound, signal to buddy to remove reef recorder
- Swim across stake numerous time to create "spokes" or "petals"
- Stop camera
- Record GPS coordinates above target 1
- Measure depth at all three scale markers
- Measure distances between marker 1 and the other two markers
- Measure the bearings between marker 1 and the other two markers
- Pick everything up and back to boat

### Labwork

- Export photos from camera into folder on lab computer
- Open `MetaShape`
- Start new project
- Add `chunk` (button in `Workspace` panel)
- Add `photos` and select all the reef record photos (button in `Workspace` panel)
- `Tools` -> `Markers` -> `Detect Markers...`
- Go to `Reference` panel
- Open `Reference` settings (wrench and hammer symbol at the topright of reference pane)
- Choose WGS84 coordinate system (to give us lat and lon)
- Change "camera accuracy (m)" and "camera accuracy (deg)" to 2.
- Change ground altitude to -1. Leave all other defaults. (*SKIP) 
- Open "orientation markers" spreadsheet (in this module's `docs` folder)
- Enter target 1 lat and lon at top of spreadsheet.
- Enter distances and angles to targets 2 and 3 into columns and retrieve these targets' coordinates.
- Enter into reference pane in Metashape.
- Highlight target pairs from scale bars (using crtl key), right-click and add scale
- Enter scale distnaces in reference pane below the target pane.
- Start workflow process: align cameras first (accuracy Low).
- Using the measurement tool, check that the scale in the sparse cloud is approximately correct. All cameras should appear above the sparse cloud (if not, is one of the angles the wrong direction?  e.g., 180 degrees off?)
- Once happy with alignments, do the dense cloud step at Medium accuracy (this takes the longest)
- Generate 3D mesh, DEM and ortho-model using defaults. Then export them.

### References

- Pizarro, O., Friedman, A., Bryson, M., Williams, S. B. & Madin, J. A simple, fast, and repeatable survey method for underwater visual 3D benthic mapping and monitoring. Ecology and Evolution 7, 1770â€“1782 (2017). [[link](https://doi.org/10.1002/ece3.2701)]
- Torres-Pulliza D, Dornelas M, Pizarro O, Bewley M, Blowes SA, Boutros N, Brambilla V, Chase TJ, Frank G, Friedman A, Hoogenboom MO, Williams S, Zawada KJA, Madin JS (2020) A geometric basis for surface habitat complexity and biodiversity. *Nature Ecology & Evolution* 4:1495-1501. [[link](https://doi.org/10.1038/s41559-020-1281-8)]
- Torres-Pulliza, D., Charendoff, J., Couch, C., Suka, R., Gray, A., Lichowski, F., ... & Oliver, T. (2024). Processing coral reef imagery using Structure-from-Motion photogrammetry: Standard operating procedures (2023 update). [[link](https://repository.library.noaa.gov/view/noaa/60890)]
